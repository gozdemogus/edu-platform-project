@{
    Layout = "~/Views/Shared/_AreaLayout.cshtml";
}

<script src="~/lib/microsoft/signalr/dist/browser/signalr.js"></script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>



<script>$(document).ready(() => {

        var connection = new signalR.HubConnectionBuilder().withAutomaticReconnect([1000, 2000, 3000, 8000]).withUrl("https://localhost:5000/AnalyticsHub").build();

    connection.start().then(function () {
        connection.invoke("DataForAll").catch(function (err) {
            return console.error(err.toString());
        });
        //connection.invoke("GetAnalytics").catch(function (err) {
        //    return console.error(err.toString());
        //});
        //connection.invoke("GetTrafficSources").catch(function (err) {
        //    return console.error(err.toString());
        //});

    }).catch(function (err) {
        return console.error(err.toString());
    });

    connection.on("ReceiveAnalytics", function (analytics) {
        console.log(analytics);
        $("#customers").text(analytics.customers);
        $("#orders").text(analytics.orders);
        $("#conversion").text(analytics.conversion);
        $("#earnings").text(analytics.earnings);
    });


    connection.on("ReceiveTrafficSources", function (trafficSources, tot,goal) {
        //console.log(trafficSources);
        var total = 0;
        var trafficSourcesHTML = "";
        var legendHTML = "";
        trafficSources.forEach(function (source) {
            console.log(source);
            totalCount = source.totalcount;
            total += source.Total;
            trafficSourcesHTML += `<div class="progress-bar  bg-${source.color}" role="progressbar" style="width: ${source.total}%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>`;
            legendHTML += `<div class="d-flex justify-content-between legend-label">
                            <div><span class="bg-${source.color}"></span>${source.name}</div>
                            <div>${source.total}</div>
                        </div>`;
        });
     //   console.log(legendHTML);
     //   console.log(tot);
        $("#chart-legends").html(legendHTML);
        $("#progressbar").html(trafficSourcesHTML);
        $("#total").html(tot);
        $("#goal").html(goal);
    });




});
    </script>


<div class="row">
        <div class="col-sm-12 mb-4 mb-xl-0">
            <h4 class="font-weight-bold text-dark">Hi, welcome back!</h4>
            <p class="font-weight-normal mb-2 text-muted">@DateTime.Now</p>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-xl-3 flex-column d-flex grid-margin stretch-card" >
            <div class="row flex-grow">
                <div class="col-sm-12 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body" >
                            <h4 class="card-title">Customers</h4>
                            <p>Conversion: <span id="conversion"></span></p>
                            <h4 class="text-dark font-weight-bold mb-2"><i class="icon icon-eye" style="color:cyan"></i> <span id="customers"></span> </h4>
                           
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Orders</h4>
                            <p>Earnings: <span id="earnings"></span></p>
                            <h4 class="text-dark font-weight-bold mb-2"><i class="icon icon-marquee-plus" style="color:lawngreen"></i> <span id="orders"></span></h4>
                           
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @*<div class="col-xl-9 d-flex grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Website Audience Metrics</h4>
                    <div class="row">
                        <div class="col-lg-5">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit amet cumque cupiditate</p>
                        </div>
                        <div class="col-lg-7">
                            <div class="chart-legends d-lg-block d-none" id="chart-legends"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <canvas id="web-audience-metrics-satacked" class="mt-3"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>*@
    <div class="row">
        @*<div class="col-xl-4 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-3">
                        <h4 class="card-title">Market Trends</h4>
                        <div class="dropdown">
                            <button class="btn btn-sm dropdown-toggle text-dark pt-0 pr-0" type="button" id="dropdownMenuSizeButton3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                This week
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuSizeButton3">
                                <h6 class="dropdown-header">This week</h6>
                                <h6 class="dropdown-header">This month</h6>
                            </div>
                        </div>
                    </div>
                    <div id="chart-legends-market-trend" class="chart-legends mt-1">
                    </div>
                    <div class="row mt-2 mb-2">
                        <div class="col-6">
                            <div class="text-small"><span class="text-success">18.2%</span> higher </div>
                        </div>
                        <div class="col-6">
                            <div class="text-small"><span class="text-danger">0.7%</span> higher </div>
                        </div>
                    </div>
                    <div class="marketTrends mt-4">
                        <canvas id="marketTrendssatacked"></canvas>
                    </div>

                </div>
            </div>
        </div>
        <div class="col-xl-4 grid-margin stretch-card">*@
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Traffic Sources</h4>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="d-flex justify-content-between mt-2 text-dark mb-2">
                                <div><span class="font-weight-bold" id="total"></span> per seconds</div>
                                <div><span class="font-weight-bold" id="goal"></span></div>
                            </div>
                            <div class="progress progress-md grouped mb-2" id="progressbar">
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="traffic-source-legend" id="chart-legends">
                                <div class="d-flex justify-content-between mb-1 mt-2">
                                    <div class="font-weight-bold">SOURCE</div>
                                    <div class="font-weight-bold">TOTAL</div>
                                </div>
                             
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title mb-3">Recent Activity</h4>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="text-dark">
                                <div class="d-flex pb-3 border-bottom justify-content-between">
                                    <div class="mr-3"><i class="mdi mdi-signal-cellular-outline icon-md"></i></div>
                                    <div class="font-weight-bold mr-sm-4">
                                        <div>Deposit has updated to Paid</div>
                                        <div class="text-muted font-weight-normal mt-1">32 Minutes Ago</div>
                                    </div>
                                    <div><h6 class="font-weight-bold text-info ml-sm-2">$325</h6></div>
                                </div>
                                <div class="d-flex pb-3 pt-3 border-bottom justify-content-between">
                                    <div class="mr-3"><i class="mdi mdi-signal-cellular-outline icon-md"></i></div>
                                    <div class="font-weight-bold mr-sm-4">
                                        <div>Your Withdrawal Proceeded</div>
                                        <div class="text-muted font-weight-normal mt-1">45 Minutes Ago</div>
                                    </div>
                                    <div><h6 class="font-weight-bold text-info ml-sm-2">$4987</h6></div>
                                </div>
                                <div class="d-flex pb-3 pt-3 border-bottom justify-content-between">
                                    <div class="mr-3"><i class="mdi mdi-signal-cellular-outline icon-md"></i></div>
                                    <div class="font-weight-bold mr-sm-4">
                                        <div>Deposit has updated to Paid                              </div>
                                        <div class="text-muted font-weight-normal mt-1">1 Days Ago</div>
                                    </div>
                                    <div><h6 class="font-weight-bold text-info ml-sm-2">$5391</h6></div>
                                </div>
                                <div class="d-flex pt-3 justify-content-between">
                                    <div class="mr-3"><i class="mdi mdi-signal-cellular-outline icon-md"></i></div>
                                    <div class="font-weight-bold mr-sm-4">
                                        <div>Deposit has updated to Paid</div>
                                        <div class="text-muted font-weight-normal mt-1">3 weeks Ago</div>
                                    </div>
                                    <div><h6 class="font-weight-bold text-info ml-sm-2">$264</h6></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

@await Component.InvokeAsync("ToDoList")
